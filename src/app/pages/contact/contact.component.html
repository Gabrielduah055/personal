<div class="container relative max-w-xl mx-auto px-5 py-2 rounded-md border border-gray-200 shadow-lg ">
  <h1 class="text-4xl font-bold text-center mb-2">Get in touch</h1>
  <p class="text-center text-neutral-500 mb-6">Fill out a form to discuss how I can help or get in touch.</p>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <div>
        <label class="block text-sm mb-1 font-medium capitalize">First name</label>
        <input type="text" formControlName="firstName"  class=" w-full border border-gray-500 rounded-md px-3 py-2 outline-none placeholder:text-gray-400 font-medium text-sm"/>
        @if (f["firstName"].touched && f["firstName"].invalid) {
          <p class="text-red-600 text-xs mt-1">First name is required</p>
        }
      </div>
      <div>
        <label class="block text-sm mb-1 font-medium capitalize ">Last name</label>
        <input type="text" formControlName="lastName" class="w-full border border-gray-500 rounded-md px-3 py-2 outline-none placeholder:text-gray-400 font-medium text-sm"/>
        @if (f["lastName"].touched && f["lastName"].invalid) {
          <p class="text-red-600 text-xs mt-1">Last name is required</p>
        }
      </div>
    </div>

    <div>
      <label class="block text-sm mb-1 font-medium">Email</label>
      <input type="email" formControlName="email" class="w-full border border-gray-500 rounded-md px-3 py-2 outline-none placeholder:text-gray-400 font-medium text-sm"/>
      @if (f["email"].touched && f["email"].invalid) {
        <p class="text-red-600 text-xs mt-1">Enter a valid email</p>
      }
    </div>

    <div>
      <label class="block text-sm mb-1">Phone number</label>
      <div class="flex gap-2 items-stretch">
        <div class="relative" (click)="$event.stopPropagation()">
          <button type="button" (click)="toggleCountryDropdown()" class="h-full min-w-28 border rounded px-2 py-2 flex items-center gap-2">
            @if (selectedCountry?.flagPngUrl) {
              <img [src]="selectedCountry!.flagPngUrl" [alt]="selectedCountry!.name" class="h-4 w-6 object-cover rounded-sm"/>
            } @else {
              <span class="text-lg">{{ selectedCountry?.flagEmoji || 'üåç' }}</span>
            }
            <span class="text-sm font-medium">{{ selectedCountry?.dialCode || '+..' }}</span>
            <svg class="ml-1 h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.06l3.71-3.83a.75.75 0 111.08 1.04l-4.24 4.38a.75.75 0 01-1.08 0L5.21 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd"/></svg>
          </button>
          <div class="absolute z-20 mt-1 w-80 bg-white border rounded shadow-lg transition transform origin-top duration-200 ease-out"
               [style.opacity]="countryDropdownOpen ? 1 : 0"
               [style.transform]="countryDropdownOpen ? 'translateY(0) scale(1)' : 'translateY(-8px) scale(0.98)'"
               [style.pointerEvents]="countryDropdownOpen ? 'auto' : 'none'">
            <div class="p-2 border-b flex items-center">
              <i class="uil uil-search"></i>
              <input class="w-full rounded px-3 py-2 text-sm outline-none" placeholder="Search country..." [value]="countrySearch" (input)="onCountrySearch($any($event.target).value)" />
            </div>
            <ul class="max-h-64 overflow-auto py-1">
              @for (c of filteredCountries; track c.code) {
                <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer flex items-center justify-between" (click)="selectCountry(c)">
                  <div class="flex items-center gap-2">
                    @if (c.flagPngUrl) {
                      <img [src]="c.flagPngUrl" [alt]="c.name" class="h-4 w-6 object-cover rounded-sm"/>
                    } @else {
                      <span class="text-lg">{{ c.flagEmoji }}</span>
                    }
                    <span class="text-sm">{{ c.name }}</span>
                  </div>
                  <span class="text-xs text-gray-600">{{ c.dialCode }}</span>
                </li>
              }
            </ul>
          </div>
        </div>

        <input type="tel" formControlName="phone" class="flex-1 border rounded px-3 py-2" placeholder="Phone number"/>
      </div>
      @if (f["phone"].touched && f["phone"].invalid) {
        <p class="text-red-600 text-xs mt-1">Phone number is required</p>
      }
    </div>

    <div>
      <label class="block text-sm mb-1 font-medium capitalize">Message</label>
      <textarea rows="5" formControlName="message" class="w-full border border-gray-500 rounded outline-gray-500 px-3 py-2"></textarea>
      @if (f["message"].touched && f["message"].invalid) {
        <p class="text-red-600 text-xs mt-1">Please enter at least 10 characters</p>
      }
    </div>

    <div class="flex justify-start my-1">
      <button type="submit" class="border rounded px-4 py-2 font-medium cursor-pointer bg-black text-white hover:bg-gray-700" [disabled]="form.invalid">Send</button>
    </div>
  </form>
</div>

@if (showSuccessModal) {
  <div class="modal-overlay" (click)="closeSuccessModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="checkmark">
        <div class="checkmark__circle"></div>
        <div class="checkmark__stem"></div>
        <div class="checkmark__kick"></div>
      </div>
      <h3 class="modal-title">Message Sent</h3>
      <p class="modal-subtitle">Thanks! I will get back to you soon.</p>
    </div>
  </div>
}
